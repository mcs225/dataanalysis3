<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Data Analysis in Social Science 3</title>
  <meta name="description" content="A website for the Data Analysis in Social Science 3 module.">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="Data Analysis in Social Science 3" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://abessudnov.net/dataanalysis3/" />
  
  <meta property="og:description" content="A website for the Data Analysis in Social Science 3 module." />
  <meta name="github-repo" content="abessudnov/dataanalysis3" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Data Analysis in Social Science 3" />
  
  <meta name="twitter:description" content="A website for the Data Analysis in Social Science 3 module." />
  

<meta name="author" content="Alexey Bessudnov">


<meta name="date" content="2018-02-19">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="joining.html">
<link rel="next" href="datavis.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-113869422-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-113869422-1');
</script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#things-to-do-before-the-next-class"><i class="fa fa-check"></i><b>1.1</b> Things to do before the next class</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="module-outline.html"><a href="module-outline.html"><i class="fa fa-check"></i><b>2</b> Module outline</a><ul>
<li class="chapter" data-level="2.1" data-path="module-outline.html"><a href="module-outline.html#practical-arrangements"><i class="fa fa-check"></i><b>2.1</b> Practical arrangements</a></li>
<li class="chapter" data-level="2.2" data-path="module-outline.html"><a href="module-outline.html#aims-of-the-module"><i class="fa fa-check"></i><b>2.2</b> Aims of the module</a></li>
<li class="chapter" data-level="2.3" data-path="module-outline.html"><a href="module-outline.html#attendance"><i class="fa fa-check"></i><b>2.3</b> Attendance</a></li>
<li class="chapter" data-level="2.4" data-path="module-outline.html"><a href="module-outline.html#assessment"><i class="fa fa-check"></i><b>2.4</b> Assessment</a></li>
<li class="chapter" data-level="2.5" data-path="module-outline.html"><a href="module-outline.html#syllabus-plan"><i class="fa fa-check"></i><b>2.5</b> Syllabus plan</a></li>
<li class="chapter" data-level="2.6" data-path="module-outline.html"><a href="module-outline.html#reading-list"><i class="fa fa-check"></i><b>2.6</b> Reading list</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="assignment.html"><a href="assignment.html"><i class="fa fa-check"></i><b>3</b> Assignment</a></li>
<li class="chapter" data-level="4" data-path="joining.html"><a href="joining.html"><i class="fa fa-check"></i><b>4</b> Joining data from the Understanding Society</a><ul>
<li class="chapter" data-level="4.1" data-path="joining.html"><a href="joining.html#joining-waves-1-and-2"><i class="fa fa-check"></i><b>4.1</b> Joining waves 1 and 2</a></li>
<li class="chapter" data-level="4.2" data-path="joining.html"><a href="joining.html#joining-waves-1-to-7"><i class="fa fa-check"></i><b>4.2</b> Joining waves 1 to 7</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="tidy-data.html"><a href="tidy-data.html"><i class="fa fa-check"></i><b>5</b> Tidy data</a><ul>
<li class="chapter" data-level="5.1" data-path="tidy-data.html"><a href="tidy-data.html#long-and-wide-formats"><i class="fa fa-check"></i><b>5.1</b> Long and wide formats</a></li>
<li class="chapter" data-level="5.2" data-path="tidy-data.html"><a href="tidy-data.html#cleaning-the-data"><i class="fa fa-check"></i><b>5.2</b> Cleaning the data</a></li>
<li class="chapter" data-level="5.3" data-path="tidy-data.html"><a href="tidy-data.html#homework"><i class="fa fa-check"></i><b>5.3</b> Homework</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="datavis.html"><a href="datavis.html"><i class="fa fa-check"></i><b>6</b> Data visualisation</a><ul>
<li class="chapter" data-level="6.1" data-path="datavis.html"><a href="datavis.html#reading-in-the-data"><i class="fa fa-check"></i><b>6.1</b> Reading in the data</a></li>
<li class="chapter" data-level="6.2" data-path="datavis.html"><a href="datavis.html#visualising-one-quantitative-variable"><i class="fa fa-check"></i><b>6.2</b> Visualising one quantitative variable</a><ul>
<li class="chapter" data-level="6.2.1" data-path="datavis.html"><a href="datavis.html#histogram."><i class="fa fa-check"></i><b>6.2.1</b> Histogram.</a></li>
<li class="chapter" data-level="6.2.2" data-path="datavis.html"><a href="datavis.html#density-chart."><i class="fa fa-check"></i><b>6.2.2</b> Density chart.</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="datavis.html"><a href="datavis.html#visualising-one-categorical-variable"><i class="fa fa-check"></i><b>6.3</b> Visualising one categorical variable</a><ul>
<li class="chapter" data-level="6.3.1" data-path="datavis.html"><a href="datavis.html#bar-plot."><i class="fa fa-check"></i><b>6.3.1</b> Bar plot.</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="datavis.html"><a href="datavis.html#visualising-two-quantitative-variables"><i class="fa fa-check"></i><b>6.4</b> Visualising two quantitative variables</a></li>
<li class="chapter" data-level="6.5" data-path="datavis.html"><a href="datavis.html#visualising-one-categorical-and-one-quantitative-variable"><i class="fa fa-check"></i><b>6.5</b> Visualising one categorical and one quantitative variable</a></li>
<li class="chapter" data-level="6.6" data-path="datavis.html"><a href="datavis.html#visualising-two-categorical-variables"><i class="fa fa-check"></i><b>6.6</b> Visualising two categorical variables</a></li>
<li class="chapter" data-level="6.7" data-path="datavis.html"><a href="datavis.html#showing-the-relationships-by-group"><i class="fa fa-check"></i><b>6.7</b> Showing the relationships by group</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Analysis in Social Science 3</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tidy-data" class="section level1">
<h1><span class="header-section-number">5</span> Tidy data</h1>
<p>In the previous part of the course (joiningData.Rmd) we learned how to join together data from seven waves of the Understanding Society. Let us open this data set.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">UndSoc &lt;-<span class="st"> </span><span class="kw">read_tsv</span>(<span class="st">&quot;myData/all7.tab&quot;</span>)</code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_integer()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(UndSoc)</code></pre></div>
<pre><code>## # A tibble: 6 x 22
##       pidp a_sex a_dvage a_vote6 b_sex b_dvage b_vote6 c_sex c_dvage
##      &lt;int&gt; &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;int&gt;   &lt;int&gt;
## 1 68001367     1      39       3    NA      NA      NA    NA      NA
## 2 68004087     1      59       2     1      60       2     1      61
## 3 68006127     2      39       4     2      40       4     2      41
## 4 68006135     2      17       4    NA      NA      NA     2      19
## 5 68006807     2      72       4     2      73       4     2      74
## 6 68007487     2      57       1     2      58       2     2      59
## # ... with 13 more variables: c_vote6 &lt;int&gt;, d_sex &lt;int&gt;, d_dvage &lt;int&gt;,
## #   d_vote6 &lt;int&gt;, e_sex &lt;int&gt;, e_dvage &lt;int&gt;, e_vote6 &lt;int&gt;, f_sex &lt;int&gt;,
## #   f_dvage &lt;int&gt;, f_vote6 &lt;int&gt;, g_sex &lt;int&gt;, g_dvage &lt;int&gt;,
## #   g_vote6 &lt;int&gt;</code></pre>
<p>Now we will work on how these data can be represented and prepared for the analysis. Please read ch.12 on Tidy Data from the R for Data Science Book – <a href="http://r4ds.had.co.nz/tidy-data.html" class="uri">http://r4ds.had.co.nz/tidy-data.html</a>.</p>
<div id="long-and-wide-formats" class="section level2">
<h2><span class="header-section-number">5.1</span> Long and wide formats</h2>
<p>Let us keep only a few observations and columns in the data and more closely look at its structure.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">UndSocExample &lt;-<span class="st"> </span>UndSoc <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(pidp <span class="op">==</span><span class="st"> </span><span class="dv">68001367</span> <span class="op">|</span><span class="st"> </span>pidp <span class="op">==</span><span class="st"> </span><span class="dv">68004087</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(pidp, a_sex<span class="op">:</span><span class="st"> </span>b_vote6)
UndSocExample</code></pre></div>
<pre><code>## # A tibble: 2 x 7
##       pidp a_sex a_dvage a_vote6 b_sex b_dvage b_vote6
##      &lt;int&gt; &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;int&gt;   &lt;int&gt;   &lt;int&gt;
## 1 68001367     1      39       3    NA      NA      NA
## 2 68004087     1      59       2     1      60       2</code></pre>
<p>These are the data for two individuals only in waves 1 and 2. The data are represented in the wide format. This means that we have one row for each individual, and data from different waves are recorded in several columns. For example, the data on sex from wave 1 is in column <em>a_sex</em> and the data on sex from wave is in <em>b_sex</em>.</p>
<p>You will find this representation of the data common in longitudinal data sets. It may be convenient for certain purposes, but it is generally recommended to keep the data in the long format (that corresponds to the tidy data principles as described in the R for Data Science book).</p>
<p>To move from the wide to the long format we can use the function <strong>melt</strong> and <strong>cast</strong> functions from the <strong>reshape2</strong> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(reshape2)

<span class="co"># First we &quot;melt&quot; the data frame.</span>
UndSocExampleMolten &lt;-<span class="st"> </span>UndSocExample <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">melt</span>(<span class="dt">id =</span> <span class="st">&quot;pidp&quot;</span>)
UndSocExampleMolten</code></pre></div>
<pre><code>##        pidp variable value
## 1  68001367    a_sex     1
## 2  68004087    a_sex     1
## 3  68001367  a_dvage    39
## 4  68004087  a_dvage    59
## 5  68001367  a_vote6     3
## 6  68004087  a_vote6     2
## 7  68001367    b_sex    NA
## 8  68004087    b_sex     1
## 9  68001367  b_dvage    NA
## 10 68004087  b_dvage    60
## 11 68001367  b_vote6    NA
## 12 68004087  b_vote6     2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Next I want to split the column variable into a column indicating wave and a column indicating variable name. </span>
<span class="co"># I will use the function separate() from tidyr.</span>

UndSocExampleSep &lt;-<span class="st"> </span>UndSocExampleMolten <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">separate</span>(variable, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;wave&quot;</span>, <span class="st">&quot;variable&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>)
UndSocExampleSep</code></pre></div>
<pre><code>##        pidp wave variable value
## 1  68001367    a      sex     1
## 2  68004087    a      sex     1
## 3  68001367    a    dvage    39
## 4  68004087    a    dvage    59
## 5  68001367    a    vote6     3
## 6  68004087    a    vote6     2
## 7  68001367    b      sex    NA
## 8  68004087    b      sex     1
## 9  68001367    b    dvage    NA
## 10 68004087    b    dvage    60
## 11 68001367    b    vote6    NA
## 12 68004087    b    vote6     2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Next we &quot;cast&quot; the molten data frame into the format we want.</span>

UndSocExampleLong &lt;-<span class="st"> </span>UndSocExampleSep <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">dcast</span>(pidp <span class="op">+</span><span class="st"> </span>wave <span class="op">~</span><span class="st"> </span>variable)
UndSocExampleLong</code></pre></div>
<pre><code>##       pidp wave dvage sex vote6
## 1 68001367    a    39   1     3
## 2 68001367    b    NA  NA    NA
## 3 68004087    a    59   1     2
## 4 68004087    b    60   1     2</code></pre>
<p>Now the data are in the “long format”. This means that we have as many rows for each individual as the number of waves, a variable indicating wave, and all other variables are in columns. In most cases with longitudinal data, the long format is easier to work with.</p>
<p>What if we want to convert the data back to the wide format?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># First melt</span>
UndSocExampleMolten2 &lt;-<span class="st"> </span>UndSocExampleLong <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">melt</span>(<span class="dt">id =</span> <span class="kw">c</span>(<span class="st">&quot;pidp&quot;</span>, <span class="st">&quot;wave&quot;</span>))
UndSocExampleMolten2</code></pre></div>
<pre><code>##        pidp wave variable value
## 1  68001367    a    dvage    39
## 2  68001367    b    dvage    NA
## 3  68004087    a    dvage    59
## 4  68004087    b    dvage    60
## 5  68001367    a      sex     1
## 6  68001367    b      sex    NA
## 7  68004087    a      sex     1
## 8  68004087    b      sex     1
## 9  68001367    a    vote6     3
## 10 68001367    b    vote6    NA
## 11 68004087    a    vote6     2
## 12 68004087    b    vote6     2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Unite the columns</span>
UndSocExampleUnited &lt;-<span class="st"> </span>UndSocExampleMolten2 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unite</span>(<span class="st">&quot;variable&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;wave&quot;</span>, <span class="st">&quot;variable&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>)
UndSocExampleUnited</code></pre></div>
<pre><code>##        pidp variable value
## 1  68001367  a_dvage    39
## 2  68001367  b_dvage    NA
## 3  68004087  a_dvage    59
## 4  68004087  b_dvage    60
## 5  68001367    a_sex     1
## 6  68001367    b_sex    NA
## 7  68004087    a_sex     1
## 8  68004087    b_sex     1
## 9  68001367  a_vote6     3
## 10 68001367  b_vote6    NA
## 11 68004087  a_vote6     2
## 12 68004087  b_vote6     2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># And now cast</span>
UndSocExampleWide &lt;-<span class="st"> </span>UndSocExampleUnited <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">dcast</span>(pidp <span class="op">~</span><span class="st"> </span>variable)
UndSocExampleWide</code></pre></div>
<pre><code>##       pidp a_dvage a_sex a_vote6 b_dvage b_sex b_vote6
## 1 68001367      39     1       3      NA    NA      NA
## 2 68004087      59     1       2      60     1       2</code></pre>
<p>We can also restructure the data using the <strong>gather</strong> and <strong>spread</strong> functions from the <strong>tidyr</strong> package (part of <strong>tidyverse</strong>). <strong>gather</strong> is roughy equivalent to <strong>melt</strong> and <strong>spread</strong> is roughy equivalent to <strong>dcast</strong>.</p>
<p>Moving from wide to long:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">UndSocExample</code></pre></div>
<pre><code>## # A tibble: 2 x 7
##       pidp a_sex a_dvage a_vote6 b_sex b_dvage b_vote6
##      &lt;int&gt; &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;int&gt;   &lt;int&gt;   &lt;int&gt;
## 1 68001367     1      39       3    NA      NA      NA
## 2 68004087     1      59       2     1      60       2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># This &quot;melts&quot; the data frame. </span>
UndSocExample <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(a_sex<span class="op">:</span>b_vote6, <span class="dt">key =</span> <span class="st">&quot;variable&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;value&quot;</span>)</code></pre></div>
<pre><code>## # A tibble: 12 x 3
##        pidp variable value
##       &lt;int&gt;    &lt;chr&gt; &lt;int&gt;
##  1 68001367    a_sex     1
##  2 68004087    a_sex     1
##  3 68001367  a_dvage    39
##  4 68004087  a_dvage    59
##  5 68001367  a_vote6     3
##  6 68004087  a_vote6     2
##  7 68001367    b_sex    NA
##  8 68004087    b_sex     1
##  9 68001367  b_dvage    NA
## 10 68004087  b_dvage    60
## 11 68001367  b_vote6    NA
## 12 68004087  b_vote6     2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Next we want to split the &quot;variable&quot; column and &quot;cast&quot; in the long format</span>
UndSocExample <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(a_sex<span class="op">:</span>b_vote6, <span class="dt">key =</span> <span class="st">&quot;variable&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;value&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">separate</span>(variable, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;wave&quot;</span>, <span class="st">&quot;variable&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">spread</span>(<span class="dt">key =</span> variable, <span class="dt">value =</span> value)</code></pre></div>
<pre><code>## # A tibble: 4 x 5
##       pidp  wave dvage   sex vote6
## *    &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1 68001367     a    39     1     3
## 2 68001367     b    NA    NA    NA
## 3 68004087     a    59     1     2
## 4 68004087     b    60     1     2</code></pre>
<p>If we want to move from long to wide:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">UndSocExampleLong</code></pre></div>
<pre><code>##       pidp wave dvage sex vote6
## 1 68001367    a    39   1     3
## 2 68001367    b    NA  NA    NA
## 3 68004087    a    59   1     2
## 4 68004087    b    60   1     2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">UndSocExampleLong <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(dvage<span class="op">:</span>vote6, <span class="dt">key =</span> <span class="st">&quot;variable&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;value&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unite</span>(<span class="st">&quot;variable&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;wave&quot;</span>, <span class="st">&quot;variable&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">spread</span>(<span class="dt">key =</span> variable, <span class="dt">value =</span> value)</code></pre></div>
<pre><code>##       pidp a_dvage a_sex a_vote6 b_dvage b_sex b_vote6
## 1 68001367      39     1       3      NA    NA      NA
## 2 68004087      59     1       2      60     1       2</code></pre>
<p><strong>Exercise</strong>. Reshape the full <strong>UndSoc</strong> data frame from wide to long format. Call the object where you will store the result <strong>UndSocLong</strong>.</p>
<p><strong>Solution:</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">UndSocLong &lt;-<span class="st"> </span>UndSoc <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(a_sex<span class="op">:</span>g_vote6, <span class="dt">key =</span> <span class="st">&quot;variable&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;value&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">separate</span>(variable, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;wave&quot;</span>, <span class="st">&quot;variable&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">spread</span>(<span class="dt">key =</span> variable, <span class="dt">value =</span> value)
UndSocLong</code></pre></div>
<pre><code>## # A tibble: 584,703 x 5
##     pidp  wave dvage   sex vote6
##  * &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1 22445     a    NA    NA    NA
##  2 22445     b    NA    NA    NA
##  3 22445     c    NA    NA    NA
##  4 22445     d    27     2     2
##  5 22445     e    28     2     2
##  6 22445     f    29     2     2
##  7 22445     g    30     2     1
##  8 29925     a    NA    NA    NA
##  9 29925     b    NA    NA    NA
## 10 29925     c    NA    NA    NA
## # ... with 584,693 more rows</code></pre>
</div>
<div id="cleaning-the-data" class="section level2">
<h2><span class="header-section-number">5.2</span> Cleaning the data</h2>
<p>Before we begin the analysis we want to make sure that the data have been cleaned and all the missing values have been correctly identified. It usually makes sense to separate the cleaning and analysis stages into separate scripts.</p>
<p>Let us explore the data set we have. Note that if we had not converted the data into the long format we would have to tabulate and clean each variable seven times.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(UndSocLong)</code></pre></div>
<pre><code>##       pidp               wave               dvage             sex        
##  Min.   :2.244e+04   Length:584703      Min.   : -9.00   Min.   :-9.00   
##  1st Qu.:4.086e+08   Class :character   1st Qu.: 32.00   1st Qu.: 1.00   
##  Median :7.493e+08   Mode  :character   Median : 46.00   Median : 2.00   
##  Mean   :7.973e+08                      Mean   : 47.09   Mean   : 1.54   
##  3rd Qu.:1.224e+09                      3rd Qu.: 61.00   3rd Qu.: 2.00   
##  Max.   :1.653e+09                      Max.   :104.00   Max.   : 2.00   
##                                         NA&#39;s   :249806   NA&#39;s   :249806  
##      vote6       
##  Min.   :-10.00  
##  1st Qu.:  2.00  
##  Median :  3.00  
##  Mean   :  1.82  
##  3rd Qu.:  4.00  
##  Max.   :  4.00  
##  NA&#39;s   :249806</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(UndSocLong<span class="op">$</span>wave)</code></pre></div>
<pre><code>## 
##     a     b     c     d     e     f     g 
## 83529 83529 83529 83529 83529 83529 83529</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(UndSocLong<span class="op">$</span>dvage)</code></pre></div>
<pre><code>## 
##   -9   -2   -1   16   17   18   19   20   21   22   23   24   25   26   27 
##   19    6   34 5735 5769 5536 5350 5188 5000 4779 4668 4537 4555 4556 4610 
##   28   29   30   31   32   33   34   35   36   37   38   39   40   41   42 
## 4742 4836 5129 5181 5286 5387 5380 5512 5591 5519 5765 5896 6155 6274 6422 
##   43   44   45   46   47   48   49   50   51   52   53   54   55   56   57 
## 6291 6450 6489 6316 6263 6187 6119 6013 5901 5727 5701 5483 5406 5193 5042 
##   58   59   60   61   62   63   64   65   66   67   68   69   70   71   72 
## 5052 4856 4782 4962 4995 5013 4999 4846 4814 4666 4435 4210 3914 3707 3504 
##   73   74   75   76   77   78   79   80   81   82   83   84   85   86   87 
## 3316 3130 2977 2749 2618 2452 2241 2106 1886 1749 1599 1390 1211  988  860 
##   88   89   90   91   92   93   94   95   96   97   98   99  100  101  102 
##  683  547  453  344  243  172  131   92   80   41   36   25   15    6    2 
##  103  104 
##    1    1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(UndSocLong<span class="op">$</span>sex)</code></pre></div>
<pre><code>## 
##     -9     -1      1      2 
##      2      1 154045 180849</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(UndSocLong<span class="op">$</span>vote6)</code></pre></div>
<pre><code>## 
##    -10     -9     -7     -2     -1      1      2      3      4 
##   4656    366  24752    431    358  30981 102212  86790  84351</code></pre>
<p>Note the negative values for dvage, sex and vote6. These are missing values that need to be coded as missing.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">UndSocLong  &lt;-<span class="st"> </span>UndSocLong <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dvage =</span> <span class="kw">ifelse</span>(dvage <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, dvage, <span class="ot">NA</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sex =</span> <span class="kw">ifelse</span>(sex <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, sex, <span class="ot">NA</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">vote6 =</span> <span class="kw">ifelse</span>(vote6 <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, vote6, <span class="ot">NA</span>))
<span class="kw">table</span>(UndSocLong<span class="op">$</span>dvage)</code></pre></div>
<pre><code>## 
##   16   17   18   19   20   21   22   23   24   25   26   27   28   29   30 
## 5735 5769 5536 5350 5188 5000 4779 4668 4537 4555 4556 4610 4742 4836 5129 
##   31   32   33   34   35   36   37   38   39   40   41   42   43   44   45 
## 5181 5286 5387 5380 5512 5591 5519 5765 5896 6155 6274 6422 6291 6450 6489 
##   46   47   48   49   50   51   52   53   54   55   56   57   58   59   60 
## 6316 6263 6187 6119 6013 5901 5727 5701 5483 5406 5193 5042 5052 4856 4782 
##   61   62   63   64   65   66   67   68   69   70   71   72   73   74   75 
## 4962 4995 5013 4999 4846 4814 4666 4435 4210 3914 3707 3504 3316 3130 2977 
##   76   77   78   79   80   81   82   83   84   85   86   87   88   89   90 
## 2749 2618 2452 2241 2106 1886 1749 1599 1390 1211  988  860  683  547  453 
##   91   92   93   94   95   96   97   98   99  100  101  102  103  104 
##  344  243  172  131   92   80   41   36   25   15    6    2    1    1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(UndSocLong<span class="op">$</span>sex)</code></pre></div>
<pre><code>## 
##      1      2 
## 154045 180849</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(UndSocLong<span class="op">$</span>vote6)</code></pre></div>
<pre><code>## 
##      1      2      3      4 
##  30981 102212  86790  84351</code></pre>
<p>We may also want to code <strong>sex</strong> as “male” and “female” and assign meaningful labels to <strong>vote6</strong> converting these variables into factors.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">UndSocLongClean &lt;-<span class="st"> </span>UndSocLong <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sex =</span> <span class="kw">recode</span>(sex, <span class="st">&quot;1&quot;</span> =<span class="st"> &quot;male&quot;</span>, <span class="st">&quot;2&quot;</span> =<span class="st"> &quot;female&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">vote6 =</span> <span class="kw">recode</span>(vote6, <span class="st">&quot;1&quot;</span> =<span class="st"> &quot;very&quot;</span>, <span class="st">&quot;2&quot;</span> =<span class="st"> &quot;fairly&quot;</span>, <span class="st">&quot;3&quot;</span> =<span class="st"> &quot;not very&quot;</span>, <span class="st">&quot;4&quot;</span> =<span class="st"> &quot;not al all&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sex =</span> <span class="kw">factor</span>(sex)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">vote6 =</span> <span class="kw">factor</span>(vote6))
UndSocLongClean</code></pre></div>
<pre><code>## # A tibble: 584,703 x 5
##     pidp  wave dvage    sex  vote6
##    &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;fctr&gt; &lt;fctr&gt;
##  1 22445     a    NA   &lt;NA&gt;   &lt;NA&gt;
##  2 22445     b    NA   &lt;NA&gt;   &lt;NA&gt;
##  3 22445     c    NA   &lt;NA&gt;   &lt;NA&gt;
##  4 22445     d    27 female fairly
##  5 22445     e    28 female fairly
##  6 22445     f    29 female fairly
##  7 22445     g    30 female   very
##  8 29925     a    NA   &lt;NA&gt;   &lt;NA&gt;
##  9 29925     b    NA   &lt;NA&gt;   &lt;NA&gt;
## 10 29925     c    NA   &lt;NA&gt;   &lt;NA&gt;
## # ... with 584,693 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">write_tsv</span>(UndSocLongClean, <span class="st">&quot;myData/all7clean.tab&quot;</span>)</code></pre></div>
</div>
<div id="homework" class="section level2">
<h2><span class="header-section-number">5.3</span> Homework</h2>
<p>To prepare for the class on 19 February please read ch. 3 (Data visualisation) from the R for Data Science book and do all the exercises – <a href="http://r4ds.had.co.nz/data-visualisation.html" class="uri">http://r4ds.had.co.nz/data-visualisation.html</a></p>
<p>Please also read ch.12 on tidy data and do all the exercises – <a href="http://r4ds.had.co.nz/tidy-data.html" class="uri">http://r4ds.had.co.nz/tidy-data.html</a></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="joining.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="datavis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": true
});
});
</script>

</body>

</html>
